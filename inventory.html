<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Vessel Inventory - Sovereigns of Ruin</title>
    <link rel="stylesheet" href="style.css">
    <style>
        body { background: #000; margin: 0; display: flex; justify-content: center; height: 100dvh; overflow: hidden; font-family: sans-serif; }
        
        .game-window {
            width: 400px;
            height: 100dvh;
            background: #000;
            display: flex;
            flex-direction: column;
            border-left: 1px solid #111;
            border-right: 1px solid #111;
        }

        /* TOP NAVIGATION */
        .top-nav {
            padding: 15px 20px;
            border-bottom: 1px solid #111;
            flex-shrink: 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .back-link {
            color: #444;
            text-decoration: none;
            font-size: 0.6rem;
            text-transform: uppercase;
            letter-spacing: 2px;
            font-weight: bold;
        }

        /* HEADER */
        .inv-header {
            padding: 20px 15px;
            text-align: center;
            flex-shrink: 0;
        }
        .inv-header h1 {
            color: var(--accent, #62ffe1);
            font-size: 1rem;
            letter-spacing: 4px;
            margin: 0;
            text-transform: uppercase;
        }

        /* CATEGORY TABS */
        .inv-tabs {
            display: flex;
            border-bottom: 1px solid #111;
            background: #050505;
        }
        .inv-tab {
            flex: 1;
            padding: 12px;
            text-align: center;
            font-size: 0.65rem;
            color: #444;
            text-transform: uppercase;
            letter-spacing: 1px;
            cursor: pointer;
            transition: 0.3s;
            font-weight: bold;
        }
        .inv-tab.active {
            color: var(--accent, #62ffe1);
            border-bottom: 2px solid var(--accent, #62ffe1);
            background: #0a0a0a;
        }

        /* GRID LIST */
        .inv-content {
            flex-grow: 1;
            padding: 15px;
            overflow-y: auto;
            display: grid;
            grid-template-columns: 1fr;
            gap: 10px;
            align-content: start;
        }

        .item-card {
            background: #0a0a0a;
            border: 1px solid #1a1a1a;
            border-radius: 6px;
            padding: 12px;
            display: flex;
            align-items: center;
            gap: 15px;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn { from { opacity: 0; transform: translateX(-10px); } to { opacity: 1; transform: translateX(0); } }

        .item-icon {
            width: 40px;
            height: 40px;
            background: #111;
            border: 1px solid #222;
            border-radius: 4px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1.2rem;
        }

        .item-details { flex-grow: 1; }
        .item-name { display: block; color: #eee; font-size: 0.75rem; font-weight: bold; text-transform: uppercase; }
        .item-type { display: block; color: #444; font-size: 0.55rem; text-transform: uppercase; margin-top: 2px; }

        .empty-msg {
            color: #222;
            text-align: center;
            font-size: 0.7rem;
            margin-top: 40px;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        /* FOOTER */
        .inv-footer {
            padding: 15px 20px;
            border-top: 1px solid #111;
            background: #050505;
        }
        .stat-row { display: flex; gap: 20px; }
        .stat-label { color: #444; font-size: 0.6rem; text-transform: uppercase; font-weight: bold; }
        .stat-val { color: var(--accent, #62ffe1); margin-left: 5px; }

        /* THEMES */
        .theme-Fire { --accent: #ff4444; }
        .theme-Water { --accent: #44aaff; }
        .theme-Wind { --accent: #62ffe1; }
        .theme-Earth { --accent: #aa7744; }
        .theme-Light { --accent: #ffffcc; }
        .theme-Shadow { --accent: #bb66ff; }
    </style>
</head>
<body id="bodyTheme">

    <div class="game-window">
        <div class="top-nav">
            <a href="map.html" class="back-link">‚Üê Return to Map</a>
        </div>

        <div class="inv-header">
            <h1>Possessions</h1>
        </div>

        <div class="inv-tabs">
            <div class="inv-tab active" data-cat="gear">Gear</div>
            <div class="inv-tab" data-cat="arcane">Arcane</div>
        </div>

        <div class="inv-content" id="invContent">
            </div>

        <div class="inv-footer">
            <div class="stat-row">
                <span class="stat-label">Weight: <span class="stat-val" id="invWeight">0/20</span></span>
                <span class="stat-label">Gold: <span class="stat-val" id="pGold">0</span></span>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, doc, onSnapshot } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
        import { initSecurity } from "./auth-guard.js";

        const firebaseConfig = { 
            apiKey: "AIzaSyCfYnzHzZ82Qdvxsd2U4bSKpDwrQ8g2WuM", 
            authDomain: "sovereigns-of-ruin.firebaseapp.com", 
            projectId: "sovereigns-of-ruin", 
            storageBucket: "sovereigns-of-ruin.firebasestorage.app", 
            messagingSenderId: "1098142064736", 
            appId: "1:1098142064736:web:002a76b2e1f8f7b22f6305" 
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        let currentCategory = 'gear';
        let playerData = null;

        const spellIcons = {
            'Fireball': 'üî•', 'Inferno Blast': 'üí•',
            'Tidal Wave': 'üåä', 'Frost Bite': '‚ùÑÔ∏è',
            'Gale Blade': 'üå™Ô∏è', 'Cyclone Step': 'üí®',
            'Stone Skin': 'ü™®', 'Quake': 'üåã',
            'Heal': '‚ú®', 'Purge': '‚òÄÔ∏è',
            'Void Bolt': 'üîÆ', 'Soul Reap': 'üíÄ'
        };

        const gearIcons = {
            'Broken Crown': 'üëë', 'Iron Visor': '‚õëÔ∏è',
            'Leather Tunic': 'üëï', 'Iron Plate': 'üõ°Ô∏è'
        };

        function renderInventory() {
            const container = document.getElementById('invContent');
            container.innerHTML = '';
            
            const items = playerData.inventory || [];
            
            // Filter logic based on tab
            const filtered = items.filter(itemName => {
                const isSpell = spellIcons[itemName];
                return currentCategory === 'arcane' ? isSpell : !isSpell;
            });

            if (filtered.length === 0) {
                container.innerHTML = `<div class="empty-msg">No ${currentCategory} detected in vessel</div>`;
                return;
            }

            filtered.forEach(itemName => {
                const icon = spellIcons[itemName] || gearIcons[itemName] || 'üì¶';
                const type = spellIcons[itemName] ? 'Manuscript' : 'Equipment';
                
                const card = document.createElement('div');
                card.className = 'item-card';
                card.innerHTML = `
                    <div class="item-icon">${icon}</div>
                    <div class="item-details">
                        <span class="item-name">${itemName}</span>
                        <span class="item-type">${type}</span>
                    </div>
                `;
                container.appendChild(card);
            });

            document.getElementById('invWeight').innerText = `${items.length}/25`;
        }

        // Tab Switching
        document.querySelectorAll('.inv-tab').forEach(tab => {
            tab.addEventListener('click', () => {
                document.querySelectorAll('.inv-tab').forEach(t => t.classList.remove('active'));
                tab.classList.add('active');
                currentCategory = tab.getAttribute('data-cat');
                if (playerData) renderInventory();
            });
        });

        onAuthStateChanged(auth, async (user) => {
            if (user) {
                await initSecurity(db, auth, user);
                onSnapshot(doc(db, "players", user.uid), (snap) => {
                    if (snap.exists()) {
                        playerData = snap.data();
                        document.getElementById('pGold').innerText = playerData.gold;
                        document.getElementById('bodyTheme').className = `theme-${playerData.element}`;
                        renderInventory();
                    }
                });
            } else {
                window.location.href = "index.html";
            }
        });
    </script>
</body>
</html>