<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Bounty Board - Sovereigns of Ruin</title>
    <link rel="stylesheet" href="style.css">
    <style>
        body { background: #000; margin: 0; display: flex; justify-content: center; overflow: hidden; font-family: sans-serif; }
        
        .game-container { 
            width: 400px; height: 100vh; background: #000; 
            display: flex; flex-direction: column; padding: 15px; box-sizing: border-box;
            border-left: 1px solid #111; border-right: 1px solid #111;
        }

        /* Reusing your Element Themes */
        .theme-Fire { --accent: #ff4444; }
        .theme-Water { --accent: #44aaff; }
        .theme-Wind { --accent: #62ffe1; }
        .theme-Earth { --accent: #aa7744; }
        .theme-Light { --accent: #ffffcc; }
        .theme-Shadow { --accent: #bb66ff; }

        /* Navigation */
        .back-nav { 
            font-size: 0.65rem; 
            color: #444; 
            cursor: pointer; 
            margin-bottom: 10px; 
            text-transform: uppercase; 
            letter-spacing: 1px; 
            transition: 0.2s;
            display: inline-block;
        }
        .back-nav:hover { color: var(--accent); }

        .header { padding: 10px 0; border-bottom: 2px solid var(--accent); margin-bottom: 15px; }
        .header h1 { font-size: 1rem; letter-spacing: 4px; color: var(--accent); margin: 0; text-transform: uppercase; }
        .header p { font-size: 0.6rem; color: #555; margin-top: 5px; text-transform: uppercase; letter-spacing: 1px; }

        .quest-list { flex-grow: 1; overflow-y: auto; display: flex; flex-direction: column; gap: 12px; padding-right: 5px; }
        .quest-list::-webkit-scrollbar { width: 3px; }
        .quest-list::-webkit-scrollbar-thumb { background: var(--accent); }
        
        .quest-card {
            background: #0a0a0a; border: 1px solid #1a1a1a; padding: 12px; border-radius: 6px;
            transition: 0.2s; position: relative;
        }
        .quest-card:hover { border-color: var(--accent); }

        .quest-title { font-size: 0.8rem; color: var(--accent); font-weight: bold; letter-spacing: 1px; margin-bottom: 4px; text-transform: uppercase; }
        .quest-desc { font-size: 0.65rem; color: #777; line-height: 1.3; margin-bottom: 12px; }
        
        .quest-footer { 
            display: flex; justify-content: space-between; align-items: center; 
            border-top: 1px solid #1a1a1a; padding-top: 8px;
        }
        .reward { font-size: 0.6rem; color: #555; letter-spacing: 1px; }
        .reward span { color: #ffcc00; font-weight: bold; }

        .accept-btn {
            background: transparent; border: 1px solid var(--accent); color: var(--accent);
            padding: 4px 10px; font-size: 0.6rem; cursor: pointer; text-transform: uppercase;
            font-weight: bold; border-radius: 3px; transition: 0.2s;
        }
        .accept-btn:hover:not(:disabled) { background: var(--accent); color: #000; }
        .accept-btn:disabled { opacity: 0.3; cursor: not-allowed; }
    </style>
</head>
<body id="bodyTheme">

    <div class="game-container">
        <div class="back-nav" onclick="window.location.href='map.html'">‚Üê Return to Village</div>
        
        <div class="header">
            <h1>The Bounty Board</h1>
            <p>Need some loot? Find work below, Sovereign.</p>
        </div>

        <div class="quest-list" id="questList">
            <div class="quest-card">
                <div class="quest-title">Shadow Grove Scavenge</div>
                <div class="quest-desc">Gather glowing moss from the outskirts. Low risk, steady pay.</div>
                <div class="quest-footer">
                    <div class="reward">REWARD: <span>15G</span> | <span>20XP</span></div>
                    <button class="accept-btn" onclick="startQuest(this, 15, 20)">Accept</button>
                </div>
            </div>

            <div class="quest-card">
                <div class="quest-title">Village Sentry</div>
                <div class="quest-desc">Protect the gates from wandering husks. Requires focus and high Vitality.</div>
                <div class="quest-footer">
                    <div class="reward">REWARD: <span>40G</span> | <span>50XP</span></div>
                    <button class="accept-btn" onclick="startQuest(this, 40, 50)">Accept</button>
                </div>
            </div>

            <div class="quest-card">
                <div class="quest-title">Feral Beast Hunt</div>
                <div class="quest-desc">A dangerous predator is stalking the Wildlands. Slay it for a heavy bounty.</div>
                <div class="quest-footer">
                    <div class="reward">REWARD: <span>100G</span> | <span>120XP</span></div>
                    <button class="accept-btn" onclick="startQuest(this, 100, 120)">Accept</button>
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, doc, updateDoc, increment } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
        import { initSecurity } from "./auth-guard.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCfYnzHzZ82Qdvxsd2U4bSKpDwrQ8g2WuM",
            authDomain: "sovereigns-of-ruin.firebaseapp.com",
            projectId: "sovereigns-of-ruin",
            storageBucket: "sovereigns-of-ruin.firebasestorage.app",
            messagingSenderId: "1098142064736",
            appId: "1:1098142064736:web:002a76b2e1f8f7b22f6305"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        onAuthStateChanged(auth, async (user) => {
            if (user) {
                const data = await initSecurity(db, auth, user);
                if(data) {
                    document.getElementById('bodyTheme').className = `theme-${data.element}`;
                }
            } else {
                window.location.href = "index.html";
            }
        });

        window.startQuest = async function(btn, goldReward, xpReward) {
            if (!auth.currentUser) return;

            btn.disabled = true;
            btn.innerText = "...";

            try {
                const playerRef = doc(db, "players", auth.currentUser.uid);
                await updateDoc(playerRef, {
                    gold: increment(goldReward),
                    xp: increment(xpReward)
                });
            } catch (e) {
                console.error("Bounty failed:", e);
                alert("The board flickers... quest connection lost.");
                btn.disabled = false;
                btn.innerText = "Accept";
            } finally {
                btn.innerText = "Claimed";
            }
        };
    </script>
</body>
</html>