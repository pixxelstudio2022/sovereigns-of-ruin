<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Birthplace Selection - Sovereigns of Ruin</title>
    <link rel="stylesheet" href="style.css">
    <style>
        h1 { color: #62ffe1; font-size: 1.2rem; letter-spacing: 1px; margin-bottom: 2px; text-transform: uppercase; }
        .subtitle { font-style: italic; color: #888; font-size: 0.75rem; margin-bottom: 15px; }
        
        .village-list { display: flex; flex-direction: column; gap: 8px; width: 100%; }
        
        .village-card { 
            background: #0d0d0d; border: 1px solid #222; padding: 10px 15px; 
            border-radius: 6px; cursor: pointer; transition: 0.2s ease;
            text-align: left; border-left: 4px solid #333;
        }

        /* Elemental Theme Coloring */
        .fire { border-left-color: #ff4444; }
        .fire .v-name { color: #ff4444; }
        
        .water { border-left-color: #44aaff; }
        .water .v-name { color: #44aaff; }

        .wind { border-left-color: #62ffe1; }
        .wind .v-name { color: #62ffe1; }

        .earth { border-left-color: #aa7744; }
        .earth .v-name { color: #aa7744; }

        .light { border-left-color: #ffffcc; }
        .light .v-name { color: #ffffcc; }

        .shadow { border-left-color: #bb66ff; }
        .shadow .v-name { color: #bb66ff; }

        .village-card:hover { background: #151515; transform: scale(1.02); }
        
        .v-name { font-weight: bold; font-size: 0.95rem; }
        .affinity { font-size: 0.65rem; text-transform: uppercase; margin-bottom: 3px; opacity: 0.7; color: #eee; }
        .description { font-size: 0.7rem; line-height: 1.2; color: #999; }

        #gatekeeper {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
            background: #050505; display: flex; justify-content: center; 
            align-items: center; z-index: 999; color: #62ffe1; font-size: 0.8rem;
        }
    </style>
</head>
<body>

    <div id="gatekeeper">READING SOUL HISTORY...</div>

    <div class="game-container">
        <h1>ORIGIN SELECTION</h1>
        <p class="subtitle">"Your choice is final."</p>

        <div class="village-list">
            <div class="village-card fire" onclick="sealDestiny('Inferno Island', 'Fire')">
                <div class="affinity">Strong vs Earth | Weak vs Water</div>
                <div class="v-name">Inferno Island</div>
                <p class="description">Forged in volcanic ash. Raw power and destructive heat.</p>
            </div>

            <div class="village-card water" onclick="sealDestiny('Glacier Reach', 'Water')">
                <div class="affinity">Strong vs Fire | Weak vs Wind</div>
                <div class="v-name">Glacier Reach</div>
                <p class="description">Hardened by eternal frost. Fluid defense and patience.</p>
            </div>

            <div class="village-card wind" onclick="sealDestiny('Gale Terrace', 'Wind')">
                <div class="affinity">Strong vs Water | Weak vs Earth</div>
                <div class="v-name">Gale Terrace</div>
                <p class="description">Bound to the endless sky. Swift, invisible, and sharp.</p>
            </div>

            <div class="village-card earth" onclick="sealDestiny('Everglade', 'Earth')">
                <div class="affinity">Strong vs Wind | Weak vs Fire</div>
                <div class="v-name">Everglade</div>
                <p class="description">Rooted in ancient soil. Unmatched resilience and resolve.</p>
            </div>
            
            <div class="village-card light" onclick="sealDestiny('Aurelian Sanctum', 'Light')">
                <div class="affinity">Bane of Shadow | Weak to Shadow</div>
                <div class="v-name">Aurelian Sanctum</div>
                <p class="description">Bathed in celestial radiance. Holy, pure, and piercing.</p>
            </div>

            <div class="village-card shadow" onclick="sealDestiny('Shadow Abyss', 'Shadow')">
                <div class="affinity">Bane of Light | Weak to Light</div>
                <div class="v-name">Shadow Abyss</div>
                <p class="description">Born from the void. Subtle, lethal, and master of darkness.</p>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCfYnzHzZ82Qdvxsd2U4bSKpDwrQ8g2WuM",
            authDomain: "sovereigns-of-ruin.firebaseapp.com",
            projectId: "sovereigns-of-ruin",
            storageBucket: "sovereigns-of-ruin.firebasestorage.app",
            messagingSenderId: "1098142064736",
            appId: "1:1098142064736:web:002a76b2e1f8f7b22f6305"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        let activeSovereign = null;

        onAuthStateChanged(auth, async (user) => {
            if (user) {
                activeSovereign = user;
                const docRef = doc(db, "players", user.uid);
                const docSnap = await getDoc(docRef);
                if (docSnap.exists() && docSnap.data().birthplace) {
                    window.location.href = "map.html";
                } else {
                    document.getElementById('gatekeeper').style.display = 'none';
                }
            } else {
                window.location.href = "index.html"; 
            }
        });

        window.sealDestiny = async (village, element) => {
            if (!activeSovereign) return;
            if (confirm(`Accept ${village} as your permanent origin?`)) {
                try {
                    await setDoc(doc(db, "players", activeSovereign.uid), {
                        name: activeSovereign.displayName,
                        birthplace: village,
                        element: element,
                        level: 1,
                        exp: 0,
                        gold: 100,
                        stats: { hp: 100, maxHp: 100, mana: 50, maxMana: 50, str: 10, vit: 10, skl: 10 },
                        timestamp: new Date()
                    });
                    window.location.href = "map.html"; 
                } catch (err) {
                    alert("The void rejected your choice.");
                }
            }
        };
    </script>
</body>
</html>